apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: checkpoint-backup-controller
  annotations:
    config.kubernetes.io/local-config: "true"

resources:
- namespace.yaml
- ../rbac/checkpoint_backup_rbac.yaml
- daemonset.yaml

# Registry credentials secret is intentionally commented out
# as it should be manually configured with actual credentials
# - registry-credentials-secret.yaml

commonLabels:
  app.kubernetes.io/name: checkpoint-backup
  app.kubernetes.io/part-of: stateful-migration-operator

images:
- name: lehuannhatrang/stateful-migration-operator
  newTag: checkpointBackup_v1.16

configMapGenerator:
- name: checkpoint-backup-config
  literals:
  - log-level=info
  - metrics-bind-address=0.0.0.0:8080
  - health-probe-bind-address=0.0.0.0:8081

patches:
- target:
    kind: DaemonSet
    name: checkpoint-backup-controller
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: lehuannhatrang/stateful-migration-operator:checkpointBackup_v1.16 